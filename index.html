<!doctype html>
<html lang="ro">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>EvoluX – Tabele</title>
  <style>
    :root{
      --bg:#ffffff; --fg:#0f172a; --card:#f8fafc; --muted:#64748b; --muted-bg:#eef2f7; --accent:#2563eb;
      --border:#e5e7eb;
    }
    body.dark{
      --bg:#0b1220; --fg:#e5e7eb; --card:#121a2a; --muted:#94a3b8; --muted-bg:#0f172a; --accent:#60a5fa;
      --border:#1f2a3b;
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--fg);font:14px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,'Helvetica Neue',Arial,'Noto Sans',sans-serif}
    .app{display:grid;grid-template-columns:260px 1fr;min-height:100svh}
    .sidebar{border-right:1px solid var(--border);padding:12px}
    .sidebar .row{display:flex;gap:8px;align-items:center;justify-content:space-between}
    .sidebar .title{font-weight:600}
    .btn, .nav-link{
      appearance:none;border:1px solid var(--border);background:var(--card);color:var(--fg);
      border-radius:10px;padding:8px 10px;cursor:pointer;transition:.15s;
    }
    .btn:hover,.nav-link:hover{border-color:var(--accent)}
    .nav-link{display:block;width:100%;text-align:left;margin:8px 0}
    .nav-link.active{outline:2px solid var(--accent)}
    .danger{border-color:#b91c1c;color:#b91c1c}
    .muted{color:var(--muted)}
    .content{padding:14px 18px}
    .toolbar{display:flex;gap:10px;align-items:center;flex-wrap:wrap;margin-bottom:12px}
    .search{
      display:flex;gap:8px;align-items:center;background:var(--card);border:1px solid var(--border);
      border-radius:999px;padding:6px 8px;min-width:380px;max-width:700px;width:100%;
    }
    .search input{flex:1;border:0;outline:0;background:transparent;color:var(--fg)}
    .search .chip{font-variant-numeric:tabular-nums}
    .card{
      background:var(--card);border:1px solid var(--border);border-radius:14px;padding:10px 12px;
      box-shadow:0 1px 0 rgba(0,0,0,.04) inset;
    }
    h3{margin:6px 0 12px 0;font-size:15px}
    .views .view{display:none}
    .views .view.active{display:block}

    table{width:100%;border-collapse:separate;border-spacing:0}
    th,td{border-top:1px solid var(--border);padding:8px 10px;vertical-align:top}
    thead th{position:sticky;top:0;background:var(--card);z-index:1}
    tbody tr:nth-child(2) td{border-top-color:var(--border)}
    tbody tr:hover td{background:color-mix(in oklab, var(--card) 90%, var(--accent) 10%)}
    .sep-row td{background:var(--muted-bg);color:var(--muted);font-style:italic}
    .hit{background:color-mix(in oklab, var(--card) 85%, var(--accent) 25%)}

    /* Expander Lane (S3) */
    details.lanes summary{cursor:pointer;outline:none;list-style:none}
    details.lanes summary::-webkit-details-marker{display:none}
    details.lanes .lanes-all{margin-top:.35rem;line-height:1.35}
    .status{margin-left:auto;color:var(--muted);font-size:12px}
    .collapse-btn{margin-left:8px}
    .collapsed .sidebar{width:56px}
    .collapsed .nav-link .txt{display:none}
    .collapsed .title{display:none}
    .collapsed .sidebar{padding:12px 8px}
    .collapsed .content{padding-left:10px}
  </style>
</head>
<body>
  <div class="app" id="app">
    <!-- SIDEBAR -->
    <aside class="sidebar">
      <div class="row">
        <div class="title">Meniu</div>
        <button id="darkBtn" class="btn" title="Dark/Light">Dark</button>
      </div>

      <button class="nav-link active" data-section="s1">Chime S1–S52 <span class="txt"></span></button>
      <button class="nav-link" data-section="s2">Curse spre XAR1 <span class="txt"></span></button>
      <button class="nav-link" data-section="s3">Curse intermodale <span class="txt"></span></button>

      <button id="wipeBtn" class="nav-link danger">Șterge datele locale</button>

      <p class="muted" style="margin-top:8px">
        Datele se încarcă din <code>/data/*.csv</code>.<br />
        Butonul de mai sus șterge doar cache-ul local.
      </p>
    </aside>

    <!-- CONTENT -->
    <main class="content">
      <!-- Toolbar: search + counters + collapse -->
      <div class="toolbar">
        <div class="search">
          <input id="searchInput" placeholder="Caută în tabelul curent… (Enter = următor, Shift+Enter = anterior)" />
          <span id="searchCount" class="chip muted">0/0</span>
          <div class="btn" id="prevBtn" title="Anterior">↑</div>
          <div class="btn" id="nextBtn" title="Următor">↓</div>
        </div>
        <button id="collapseBtn" class="btn collapse-btn" title="Ascunde/arată meniul">☰</button>
        <span id="status" class="status"></span>
      </div>

      <div class="views">
        <!-- S1 -->
        <section id="s1" class="view active">
          <div class="card">
            <h3>Chime S1–S52</h3>
            <div id="out-s1" class="out"></div>
          </div>
        </section>

        <!-- S2 -->
        <section id="s2" class="view">
          <div class="card">
            <h3>Curse spre XAR1</h3>
            <div id="out-s2" class="out"></div>
          </div>
        </section>

        <!-- S3 (intermodale) -->
        <section id="s3" class="view">
          <div class="card">
            <h3>Curse intermodale</h3>
            <div id="out-s3" class="out"></div>
          </div>
        </section>
      </div>
    </main>
  </div>

  <!-- App -->
  <script defer src="./app.js?v=48"></script>

  <script>
    // Mic bootstrap de UI (dark + collapse + nav). Logica mare e în app.js.
    (function(){
      const app = document.getElementById('app');
      const darkBtn = document.getElementById('darkBtn');
      const collapseBtn = document.getElementById('collapseBtn');
      const searchInput = document.getElementById('searchInput');
      const searchCount = document.getElementById('searchCount');
      const nextBtn = document.getElementById('nextBtn');
      const prevBtn = document.getElementById('prevBtn');

      // Dark
      const THEME_KEY='app-theme';
      function applyTheme(t){ document.body.classList.toggle('dark', t==='dark'); darkBtn.textContent = document.body.classList.contains('dark')?'Light':'Dark'; }
      applyTheme(localStorage.getItem(THEME_KEY)||'light');
      darkBtn.addEventListener('click', ()=>{
        const nxt = document.body.classList.contains('dark')?'light':'dark';
        localStorage.setItem(THEME_KEY, nxt); applyTheme(nxt);
      });

      // Collapse
      collapseBtn.addEventListener('click', ()=> app.classList.toggle('collapsed'));

      // Navegare
      const views = [...document.querySelectorAll('.view')];
      function show(id){
        views.forEach(v=>v.classList.toggle('active', v.id===id));
        document.querySelectorAll('.nav-link').forEach(b=>b.classList.toggle('active', b.dataset.section===id));
        // anunță app.js (are hook-uri pentru încărcări)
        document.dispatchEvent(new CustomEvent('view:change', { detail:{id} }));
      }
      document.querySelectorAll('.nav-link[data-section]').forEach(b=>{
        b.addEventListener('click', ()=> show(b.dataset.section));
      });

      // Search UI – app.js se ocupă de highlight; aici doar forward controalele
      nextBtn.addEventListener('click', ()=> document.dispatchEvent(new CustomEvent('search:next')));
      prevBtn.addEventListener('click', ()=> document.dispatchEvent(new CustomEvent('search:prev')));
      searchInput.addEventListener('input', e=> document.dispatchEvent(new CustomEvent('search:q',{detail:{q:e.target.value}})));

      // App.js actualizează counterul
      document.addEventListener('search:count', e=>{
        const {idx,total} = e.detail||{idx:0,total:0};
        searchCount.textContent = `${total?idx+1:0}/${total||0}`;
      });

      // pornește pe S1
      show('s1');
    })();
  </script>
</body>
</html>
